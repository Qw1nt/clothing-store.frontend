import{a as W,S as B,k as J,r as z,T as D,U as F,f as S,l as G,h as E,m as f,q as r,u as i,I as Z,J as H,t as w,p as C,B as X,w as Y,V as K,z as Q,E as ee,o as M,G as T,s as te,W as se,X as ae,L as ne,Y as oe}from"./entry.6a536ff6.js";/* empty css                 *//* empty css                   *//* empty css                  */import{c as N,r as re,e as ie,m as le,u as ce}from"./index.068b076f.js";import{_ as de}from"./page-header.vue.8fc97ede.js";/*! maska v2.1.9 | (c) Alexander Shabunevich | Released under the MIT license */var ue=Object.defineProperty,pe=(n,t,e)=>t in n?ue(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,R=(n,t,e)=>(pe(n,typeof t!="symbol"?t+"":t,e),e);const q={"#":{pattern:/[0-9]/},"@":{pattern:/[a-zA-Z]/},"*":{pattern:/[a-zA-Z0-9]/}};class P{constructor(t={}){R(this,"opts",{}),R(this,"memo",new Map);const e={...t};if(e.tokens!=null){e.tokens=e.tokensReplace?{...e.tokens}:{...q,...e.tokens};for(const s of Object.values(e.tokens))typeof s.pattern=="string"&&(s.pattern=new RegExp(s.pattern))}else e.tokens=q;Array.isArray(e.mask)&&(e.mask.length>1?e.mask=[...e.mask].sort((s,a)=>s.length-a.length):e.mask=e.mask[0]??""),e.mask===""&&(e.mask=null),this.opts=e}masked(t){return this.process(t,this.findMask(t))}unmasked(t){return this.process(t,this.findMask(t),!1)}isEager(){return this.opts.eager===!0}isReversed(){return this.opts.reversed===!0}completed(t){const e=this.findMask(t);if(this.opts.mask==null||e==null)return!1;const s=this.process(t,e).length;return typeof this.opts.mask=="string"?s>=this.opts.mask.length:typeof this.opts.mask=="function"?s>=e.length:this.opts.mask.filter(a=>s>=a.length).length===this.opts.mask.length}findMask(t){const e=this.opts.mask;if(e==null)return null;if(typeof e=="string")return e;if(typeof e=="function")return e(t);const s=this.process(t,e.slice(-1).pop()??"",!1);return e.find(a=>this.process(t,a,!1).length>=s.length)??""}escapeMask(t){const e=[],s=[];return t.split("").forEach((a,c)=>{a==="!"&&t[c-1]!=="!"?s.push(c-s.length):e.push(a)}),{mask:e.join(""),escaped:s}}process(t,e,s=!0){var a;if(e==null)return t;const c=`value=${t},mask=${e},masked=${s?1:0}`;if(this.memo.has(c))return this.memo.get(c);const{mask:u,escaped:m}=this.escapeMask(e),_=[],x=this.opts.tokens!=null?this.opts.tokens:{},o=this.isReversed()?-1:1,y=this.isReversed()?"unshift":"push",$=this.isReversed()?0:u.length-1,h=this.isReversed()?()=>p>-1&&g>-1:()=>p<u.length&&g<t.length,l=k=>!this.isReversed()&&k<=$||this.isReversed()&&k>=$;let V,b=-1,p=this.isReversed()?u.length-1:0,g=this.isReversed()?t.length-1:0;for(;h();){const k=u.charAt(p),v=x[k],d=(v==null?void 0:v.transform)!=null?v.transform(t.charAt(g)):t.charAt(g);if(!m.includes(p)&&v!=null){if(d.match(v.pattern)!=null)_[y](d),v.repeated?(b===-1?b=p:p===$&&p!==b&&(p=b-o),$===b&&(p-=o)):v.multiple&&(p-=o),p+=o;else if(v.multiple){const I=((a=_[g-o])==null?void 0:a.match(v.pattern))!=null,A=u.charAt(p+o);I&&A!==""&&x[A]==null?(p+=o,g-=o):_[y]("")}else d===V?V=void 0:v.optional&&(p+=o,g-=o);g+=o}else s&&!this.isEager()&&_[y](k),d===k&&!this.isEager()?g+=o:V=k,this.isEager()||(p+=o);if(this.isEager())for(;l(p)&&(x[u.charAt(p)]==null||m.includes(p));)s?_[y](u.charAt(p)):u.charAt(p)===t.charAt(g)&&(g+=o),p+=o}return this.memo.set(c,_.join("")),this.memo.get(c)}}const L=n=>JSON.parse(n.replaceAll("'",'"')),j=(n,t={})=>{const e={...t};return n.dataset.maska!=null&&n.dataset.maska!==""&&(e.mask=me(n.dataset.maska)),n.dataset.maskaEager!=null&&(e.eager=U(n.dataset.maskaEager)),n.dataset.maskaReversed!=null&&(e.reversed=U(n.dataset.maskaReversed)),n.dataset.maskaTokensReplace!=null&&(e.tokensReplace=U(n.dataset.maskaTokensReplace)),n.dataset.maskaTokens!=null&&(e.tokens=he(n.dataset.maskaTokens)),e},U=n=>n!==""?!!JSON.parse(n):!0,me=n=>n.startsWith("[")&&n.endsWith("]")?L(n):n,he=n=>{if(n.startsWith("{")&&n.endsWith("}"))return L(n);const t={};return n.split("|").forEach(e=>{const s=e.split(":");t[s[0]]={pattern:new RegExp(s[1]),optional:s[2]==="optional",multiple:s[2]==="multiple",repeated:s[2]==="repeated"}}),t};class ge{constructor(t,e={}){R(this,"items",new Map),R(this,"beforeinputEvent",s=>{const a=s.target,c=this.items.get(a);c.isEager()&&"inputType"in s&&s.inputType.startsWith("delete")&&c.unmasked(a.value).length<=1&&this.setMaskedValue(a,"")}),R(this,"inputEvent",s=>{if(s instanceof CustomEvent&&s.type==="input"&&s.detail!=null&&typeof s.detail=="object"&&"masked"in s.detail)return;const a=s.target,c=this.items.get(a),u=a.value,m=a.selectionStart,_=a.selectionEnd;let x=u;if(c.isEager()){const o=c.masked(u),y=c.unmasked(u);y===""&&"data"in s&&s.data!=null?x=s.data:y!==c.unmasked(o)&&(x=y)}if(this.setMaskedValue(a,x),"inputType"in s&&(s.inputType.startsWith("delete")||m!=null&&m<u.length))try{a.setSelectionRange(m,_)}catch{}}),this.options=e,typeof t=="string"?this.init(Array.from(document.querySelectorAll(t)),this.getMaskOpts(e)):this.init("length"in t?Array.from(t):[t],this.getMaskOpts(e))}destroy(){for(const t of this.items.keys())t.removeEventListener("input",this.inputEvent),t.removeEventListener("beforeinput",this.beforeinputEvent);this.items.clear()}needUpdateOptions(t,e){const s=this.items.get(t),a=new P(j(t,this.getMaskOpts(e)));return JSON.stringify(s.opts)!==JSON.stringify(a.opts)}needUpdateValue(t){const e=t.dataset.maskaValue;return e==null&&t.value!==""||e!=null&&e!==t.value}getMaskOpts(t){const{onMaska:e,preProcess:s,postProcess:a,...c}=t;return c}init(t,e){for(const s of t){const a=new P(j(s,e));this.items.set(s,a),s.value!==""&&this.setMaskedValue(s,s.value),s.addEventListener("input",this.inputEvent),s.addEventListener("beforeinput",this.beforeinputEvent)}}setMaskedValue(t,e){const s=this.items.get(t);this.options.preProcess!=null&&(e=this.options.preProcess(e));const a=s.masked(e),c=s.unmasked(s.isEager()?a:e),u=s.completed(e),m={masked:a,unmasked:c,completed:u};e=a,this.options.postProcess!=null&&(e=this.options.postProcess(e)),t.value=e,t.dataset.maskaValue=e,this.options.onMaska!=null&&(Array.isArray(this.options.onMaska)?this.options.onMaska.forEach(_=>_(m)):this.options.onMaska(m)),t.dispatchEvent(new CustomEvent("maska",{detail:m})),t.dispatchEvent(new CustomEvent("input",{detail:m}))}}const O=new WeakMap,ke=n=>{setTimeout(()=>{var t;((t=O.get(n))==null?void 0:t.needUpdateValue(n))===!0&&n.dispatchEvent(new CustomEvent("input"))})},_e=(n,t)=>{const e=n instanceof HTMLInputElement?n:n.querySelector("input"),s={...t.arg};if(e==null)return;ke(e);const a=O.get(e);if(a!=null){if(!a.needUpdateOptions(e,s))return;a.destroy()}if(t.value!=null){const c=t.value,u=m=>{c.masked=m.masked,c.unmasked=m.unmasked,c.completed=m.completed};s.onMaska=s.onMaska==null?u:Array.isArray(s.onMaska)?[...s.onMaska,u]:[s.onMaska,u]}O.set(e,new ge(e,s))},ve={class:"grid grid-cols-8"},fe=r("div",{class:"col-span-2"},null,-1),ye={class:"col-span-4"},xe={key:0},Ee=r("p",{class:"text-2xl"},"Ваша корзина пуста",-1),Me=[Ee],Ve={key:1},be={class:"mt-5"},we={class:"grid grid-cols-9 gap-x-10"},$e={class:"col-span-4"},Ae={class:"uppercase text-gray-500 text-sm"},Re={class:"col-span-2 flex items-center"},Ce={class:"flex items-center text-lg"},Ie={class:"flex items-center"},Ne=r("p",{class:"text-lg font-medium text-gray-700 mt-10"},"ОФОРМЛЕНИЕ ЗАКАЗА",-1),Ue={class:"grid grid-cols-3 mt-10"},Oe={class:"col-span-2"},Se={class:"grid grid-cols-6 items-center justify-items-start mb-3"},Te=r("p",{class:"text-sm col-span-2"},"Фамилия/Имя:",-1),qe={key:0,class:"col-start-3 col-span-3 text-xs text-red-500"},Pe={class:"grid grid-cols-6 items-center justify-items-start mb-3"},je=r("p",{class:"text-sm col-span-2"},"Телефон:",-1),Le={key:0,class:"col-start-3 col-span-3 text-xs text-red-500"},We={class:"grid grid-cols-6 items-center justify-items-start mb-3"},Be=r("p",{class:"text-sm col-span-2"},"E-mail:",-1),Je={key:0,class:"col-start-3 col-span-3 text-xs text-red-500"},ze={class:"grid grid-cols-6 justify-items-start mb-3"},De=r("p",{class:"text-sm col-span-2"},"Комментарий:",-1),Fe={class:"grid grid-cols-6 items-center justify-items-start mb-3"},Ge=r("p",{class:"text-sm col-span-2"},"Адрес доставки:",-1),Ze={key:0,class:"col-start-3 col-span-3 text-xs text-red-500"},He={class:"grid grid-cols-2 gap-x-5 h-24"},Xe=r("p",{class:"uppercase text-md text-left"},"Сумма заказа:",-1),Ye={class:"text-md text-right"},Ke=r("p",{class:"uppercase text-md text-left"},"Доставка:",-1),Qe=r("p",{class:"text-md text-right"},"0 ₽",-1),et=r("p",{class:"uppercase text-md text-left"},"Скидка:",-1),tt=r("p",{class:"text-md text-right"},"- ₽",-1),lt=W({__name:"index",setup(n){const t=new B(J()),e=z([]),s=D(),a=F({}),c=S(()=>{let h=0;return e.value.forEach(l=>{h+=l.product.price*l.count}),h}),u=N.withMessage("Обязательное поле",re),m=N.withMessage("Некорректный адрес электронной почты",ie),_=N.withMessage("Некорректный формат",le(18)),x=S(()=>({name:{required:u},phoneNumber:{required:u,minLength:_},email:{required:u,email:m},address:{required:u}})),o=ce(x,a);async function y(h){await s.removeItemFromCart(h,e.value[h].id,l=>e.value.splice(h,1))}async function $(){if(await o.value.$validate(),o.value.$error)return;a.cartItems=e.value;const h=await t.checkout(a);if(h.errors!=null){K.error(h.errors);return}s.resetCartItems(),e.value=[];const l=[];a.cartItems.forEach(V=>{l.push({productId:V.product.id,count:V.count})}),await t.updatePurchasedCount(l)}return G(async()=>{await t.getItems(h=>e.value=h)}),(h,l)=>{const V=se,b=ae,p=ne,g=oe,k=Q,v=ee;return M(),E("div",null,[f(de,{header:"Корзина"}),r("div",ve,[fe,r("div",ye,[i(e).length==0?(M(),E("div",xe,Me)):(M(),E("div",Ve,[(M(!0),E(Z,null,H(i(e),(d,I)=>(M(),E("div",be,[r("div",we,[f(V,{"preview-src-list":[i(T)(d.product.imageUrl)],src:i(T)(d.product.imageUrl)},null,8,["preview-src-list","src"]),r("div",$e,[r("p",Ae,w(d.product.name),1)]),r("div",Re,[f(b,{class:"h-10",modelValue:d.count,"onUpdate:modelValue":A=>d.count=A,min:1},null,8,["modelValue","onUpdate:modelValue"])]),r("p",Ce,w(d.product.price)+"₽",1),r("div",Ie,[f(p,{size:"24",onClick:A=>y(I),class:"text-gray-700 cursor-pointer hover:text-red-500",name:"ph:trash"},null,8,["onClick"])])]),f(g)]))),256)),Ne,r("form",Ue,[r("div",Oe,[r("div",Se,[Te,f(k,{id:"name",name:"name",onChange:l[0]||(l[0]=d=>i(o).name.$touch()),class:"col-span-3",modelValue:i(a).name,"onUpdate:modelValue":l[1]||(l[1]=d=>i(a).name=d),placeholder:"Фамилия/Имя:"},null,8,["modelValue"]),i(o).name.$error?(M(),E("span",qe,w(i(o).name.$errors[0].$message),1)):C("",!0)]),r("div",Pe,[je,X(f(k,{onChange:l[2]||(l[2]=d=>i(o).phoneNumber.$touch()),modelValue:i(a).phoneNumber,"onUpdate:modelValue":l[3]||(l[3]=d=>i(a).phoneNumber=d),"data-maska":"+7 (###) ###-##-##",class:"col-span-3",placeholder:"+7(___)___-__-__"},null,8,["modelValue"]),[[i(_e)]]),i(o).phoneNumber.$error?(M(),E("span",Le,w(i(o).phoneNumber.$errors[0].$message),1)):C("",!0)]),r("div",We,[Be,f(k,{id:"email",name:"email",onChange:l[4]||(l[4]=d=>i(o).email.$touch()),modelValue:i(a).email,"onUpdate:modelValue":l[5]||(l[5]=d=>i(a).email=d),class:"col-span-3",placeholder:"E-mail:"},null,8,["modelValue"]),i(o).email.$error?(M(),E("span",Je,w(i(o).email.$errors[0].$message),1)):C("",!0)]),r("div",ze,[De,f(k,{modelValue:i(a).comment,"onUpdate:modelValue":l[6]||(l[6]=d=>i(a).comment=d),class:"col-span-3",type:"textarea",placeholder:"Комментарий:"},null,8,["modelValue"])]),r("div",Fe,[Ge,f(k,{id:"email",name:"email",onChange:l[7]||(l[7]=d=>i(o).address.$touch()),modelValue:i(a).address,"onUpdate:modelValue":l[8]||(l[8]=d=>i(a).address=d),class:"col-span-3",placeholder:"Город, населённый пункт, дом, квартира"},null,8,["modelValue"]),i(o).address.$error?(M(),E("span",Ze,w(i(o).address.$errors[0].$message),1)):C("",!0)])]),r("div",He,[Xe,r("p",Ye,w(i(c))+" ₽",1),Ke,Qe,et,tt,f(v,{onClick:$,type:"primary",class:"col-span-2 uppercase p-2 mt-5",size:"large"},{default:Y(()=>[te("Оформить заказ ")]),_:1})])])]))])])])}}});export{lt as default};
